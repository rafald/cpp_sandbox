#!/bin/bash

if [ ! -d $3 ] ; then
    git clone --depth 1 --branch $1 $2 $3
    pushd $3
    git submodule init

    full_clone $1
    
    # which gcc   $ /usr/bin/gcc
    #echo "using gcc : : /usr/bin/gcc-5 ; " >> tools/build/src/user-config.jam
    popd
else
    echo "$3 dir already present"
fi

function full_clone() {
    for i in $(sed -n 's/\[submodule "\(.*\)"\]/\1/p' .gitmodules | sort); do
        spath=$(git config -f .gitmodules --get submodule.$i.path)
        surl=$(git config -f .gitmodules --get submodule.$i.url)
        git clone --depth 1 --branch $1 $surl $spath
    done
    git submodule update
}

function partial_clone() {
    for mod in chrono config function mpl ratio predef preprocessor smart_ptr system test throw_exception timer type_traits utility ;
    do
        git clone --depth 1 --branch $1 https://github.com/boostorg/${mod}.git libs/${mod}
    done
    
    git clone --depth 1 --branch $1 https://github.com/boostorg/build.git tools/build
    git clone --depth 1 --branch $1 https://github.com/boostorg/inspect.git tools/inspect
}


