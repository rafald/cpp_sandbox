# Echo [ SHELL "./write_version.sh" ] ; # runs the script from Jamfile dir /not Jamroot dir/
# ^ in Jamroot /must be run before loading of this file/

import notfile ;

import python ;
if ! [ python.configured ]
{
    ECHO "notice: no Python configured in user-config.jam" ;
    ECHO "notice: will use default configuration" ;
    using python ;
}
#use-project boost : ./boost ;
  
  
  
path-constant MYPROJECT_ROOT : . ;
path-constant TOP : . ;

# required by .travis.yml but normally in user_config.jam
import boost ;
boost.use-project ; 


project 
        : usage-requirements 
                <include>.
                <implicit-dependency>/boost//headers
                <cxxflags>"-std=c++1y "
        : requirements 
				<library>/boost//unit_test_framework
			    #        <dependency>/boost//headers # <= THIS _ALWAYS_ REBUILDS TARGETS even if up to date
				<implicit-dependency>/boost//headers
                <cxxflags>"-std=c++1y "
                <include>EIGEN # /home/raf12/develop/c++/eigen
                #<linkflags>"-lcholmod -lmetis -lamd -lcamd -lccolamd -lcolamd -llapack -lgfortran -lblas "
;


Echo [ SHELL "date +'%D %T'" ] ;

run strict_aliasing.c : <optimization>speed ;
# optimization speed space off

# different alternatives/rules for different toolsets
run tmpl_alias_overload.cpp : <toolset>clang ;
alias tmpl_alias_overload : : <toolset>gcc ;

run agregate_initialization.cpp ;
explicit agregate_initialization ;
run test_concepts.cpp ;
run test_auto_cpp17.cpp ;
run test_Eigen_QR.cpp ;
run ret_mult_values.cpp ;
run tmpl_inst.cpp 
	: #args * 
	: #input-files * 
	: #requirements * 
		<cxxflags>"`pkg-config --cflags dbus-1`"
          	<linkflags>"`pkg-config --libs dbus-1`"
	: #target-name ?
	: #default-build * 
;
explicit tmpl_inst ;

unit-test test_dispatcher : test_dispatcher.cpp 
  # /site-config//zlib /site-config//librt /site-config//crypto /site-config//ssl 
  ; 

rule explicit-unit-test ( target : source : properties * )
{
    unit-test $(target) : $(source) : $(properties) ;
    explicit $(target) ;
}
explicit-unit-test test_bind : test_bind.cpp 
	: <testing.launcher>"valgrind --leak-check=full --show-leak-kinds=all " # -v 
;

test-suite my_suite
:
      [ run test_ct_hash.cpp ]
      [ run test_Eigen.cpp ]
;
explicit my_suite ; # ! explicit can be used without declaration - introduced first !






# The six rules ALWAYS, LEAVES, NOCARE, NOTFILE, NOUPDATE, and TEMPORARY modify the dependency graph so that bjam treats the targets differently during its target binding phase.




# This Jamfile requires boost-build v2 to build.
# The version shipped with boost 1.34.0

#import modules ;
#import os ;
#import errors ;
#import feature : feature ;
#import package ;
#import virtual-target ;

#if ! $(BOOST_ROOT)
#{
#    BOOST_ROOT = [ modules.peek : BOOST_ROOT ] ;
#}
#BOOST_ROOT = [ modules.peek : BOOST_ROOT ] ;


#CXXFLAGS = [ modules.peek : CXXFLAGS ] ;
#LDFLAGS = [ modules.peek : LDFLAGS ] ;

#ECHO "BOOST_ROOT =" $(BOOST_ROOT) ;
#ECHO "OS =" [ os.name ] ;

#if $(BOOST_ROOT)
#{
#	use-project /boost : $(BOOST_ROOT) ;
#}

rule run-test ( test-name : sources + : requirements * )
{
    import testing ;
    testing.make-test run-pyd : $(sources) : $(requirements) : $(test-name) ;
}




# http://www.boost.org/build/doc/html/bbv2/builtins/raw.html

install install-app : test_dispatcher : <location>install_dir ;

notfile . : @unconditional-post-install : install-app ;
actions unconditional-post-install
{
    echo Unconditional post install run. Install is now done. 
    echo "$(<) $(>) "
}

#make file.out : file.in : @in2out ;
# Jamfile</home/raf12/develop/cpp_sandbox>.in2out bin/clang-linux-3.6.2/debug/file.out
make file.out : test_dispatcher : @in2out ;
actions in2out
{
    echo in2out $(<) $(>) 
    # in2out bin/clang-linux-3.6.2/debug/file.out bin/clang-linux-3.6.2/debug/test_dispatcher.passed
    # test_dispatcher 
    #    is replaced with
    # bin/clang-linux-3.6.2/debug/test_dispatcher.passed
    touch $(<)
}


notfile unconditional_action : @unconditional_action ;
actions unconditional_action
{
    echo "running unconditional_action"
    #./write_version.sh
    #touch "wrote"
}

run quiz_aliasing.cpp ; 
run test_enum_bit_op.cpp ;
